<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reen AI | Creative & Science Suite</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Animation -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root {
            /* Romantic/Soft Theme */
            --primary-color: #a18cd1;
            --secondary-color: #fbc2eb;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --text-color: #4a4a4a;
        }

        body {
            background: linear-gradient(120deg, #a18cd1 0%, #fbc2eb 100%);
            font-family: 'Lato', sans-serif;
            min-height: 100vh;
            color: var(--text-color);
            background-size: cover;
            background-attachment: fixed;
        }

        .title-font { font-family: 'Playfair Display', serif; }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.9);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        /* Tabs Styling */
        .nav-pills .nav-link {
            color: #666;
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: 600;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #a18cd1, #9575cd);
            color: white;
            box-shadow: 0 4px 15px rgba(161, 140, 209, 0.4);
        }

        /* Buttons */
        .btn-reen {
            background: #2d2d2d;
            color: white;
            border-radius: 30px;
            padding: 12px 30px;
            border: none;
            transition: all 0.3s;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .btn-reen:hover { 
            transform: translateY(-2px); 
            background: #000; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            color: white;
        }

        /* Image Display Area */
        .image-stage {
            min-height: 400px;
            background: #ffffff;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #e0e0e0;
            overflow: hidden;
            position: relative;
            transition: all 0.3s;
        }
        
        .image-stage img { 
            max-width: 100%; 
            max-height: 400px;
            border-radius: 10px; 
            transition: 0.5s; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        /* Filter Chips */
        .filter-chip {
            cursor: pointer;
            background: white;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-right: 8px;
            margin-bottom: 8px;
            border: 1px solid #eee;
            transition: 0.2s;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .filter-chip:hover { 
            background: var(--primary-color); 
            color: white; 
            border-color: transparent; 
            transform: translateY(-2px);
        }

        .spinner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
        }
    </style>
</head>
<body>

<div class="container py-5">
    <!-- Header -->
    <div class="text-center mb-5 animate__animated animate__fadeInDown">
        <h1 class="display-3 title-font fw-bold text-white"><i class="fa-solid fa-heart me-3 text-white"></i>Reen AI</h1>
        <p class="lead text-white fs-5" style="text-shadow: 0 2px 4px rgba(0,0,0,0.1);">Your Personal Biochemistry & Creative Studio</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-11">
            <div class="glass-panel p-4 p-md-5">
                
                <!-- Navigation -->
                <ul class="nav nav-pills mb-5 justify-content-center" id="pills-tab" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" id="pills-biochem-tab" data-bs-toggle="pill" data-bs-target="#pills-biochem" type="button">
                            <i class="fa-solid fa-flask me-2"></i>Biochemistry
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="pills-creative-tab" data-bs-toggle="pill" data-bs-target="#pills-creative" type="button">
                            <i class="fa-solid fa-paintbrush me-2"></i>Image Studio
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="pills-tabContent">
                    
                    <!-- BIOCHEM MODULE -->
                    <div class="tab-pane fade show active" id="pills-biochem">
                        <div class="row align-items-center g-5">
                            <div class="col-md-6">
                                <h2 class="title-font mb-3 text-dark">Molecule Analysis</h2>
                                <p class="text-muted mb-4">Enter a SMILES structure to identify functional groups and classify the compound using your custom AI model.</p>
                                
                                <div class="form-floating mb-4">
                                    <input type="text" class="form-control rounded-4 bg-light border-0" id="smilesInput" placeholder="SMILES" value="C[C@]12C[C@@H](C)C3=C(C=CC(=O)C=C3)[C@@H]1CC[C@]2(O)C(=O)CO">
                                    <label for="smilesInput">Chemical Structure (SMILES)</label>
                                </div>
                                <button onclick="analyzeMolecule()" class="btn btn-reen w-100 shadow-lg">
                                    <i class="fa-solid fa-microscope me-2"></i>Analyze Structure
                                </button>
                                
                                <div class="mt-4">
                                    <p class="small text-muted mb-2 text-uppercase fw-bold">Quick Examples:</p>
                                    <span class="badge bg-light text-dark border cursor-pointer p-2 me-2" onclick="fillSmiles('CC(=O)OC1=CC=CC=C1C(=O)O')">üíä Aspirin</span> 
                                    <span class="badge bg-light text-dark border cursor-pointer p-2" onclick="fillSmiles('CN1C=NC2=C1C(=O)N(C(=O)N2C)C')">‚òï Caffeine</span>
                                </div>
                            </div>
                            
                            <div class="col-md-6 text-center">
                                <div id="chemResult" class="d-none animate__animated animate__fadeIn">
                                    <div class="bg-white p-4 rounded-4 shadow-sm border">
                                        <img id="molImage" src="" class="img-fluid mb-3" style="max-height: 200px;">
                                        <h3 class="title-font text-primary mb-1" id="molClass"></h3>
                                        <p class="text-muted small mb-3">Predicted Classification</p>
                                        
                                        <div class="d-flex align-items-center justify-content-center">
                                            <span class="small me-2 fw-bold text-muted">Confidence:</span>
                                            <div class="progress flex-grow-1" style="height: 8px; max-width: 150px;">
                                                <div id="molConf" class="progress-bar bg-primary" role="progressbar" style="width: 0%"></div>
                                            </div>
                                            <span class="small ms-2 fw-bold" id="confText">0%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Empty State -->
                                <div id="chemEmpty" class="text-muted opacity-50 py-5">
                                    <i class="fa-solid fa-atom fa-4x mb-3"></i>
                                    <p>Results will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CREATIVE MODULE -->
                    <div class="tab-pane fade" id="pills-creative">
                        <div class="row g-5">
                            <div class="col-md-5">
                                <h2 class="title-font mb-3 text-dark">AI Art Generator</h2>
                                <p class="text-muted mb-4">Create beautiful imagery for your projects or just for fun.</p>
                                
                                <div class="mb-3">
                                    <textarea class="form-control rounded-4 p-3 border-0 bg-light shadow-inner" id="imgPrompt" rows="4" placeholder="Describe an image for Reen... (e.g. 'A futuristic laboratory with pink neon lights')"></textarea>
                                </div>
                                <button onclick="generateImage()" id="genBtn" class="btn btn-reen w-100 mb-5 shadow-lg">
                                    <i class="fa-solid fa-wand-magic-sparkles me-2"></i>Generate Art
                                </button>

                                <div id="editorTools" class="d-none animate__animated animate__fadeInUp">
                                    <h5 class="title-font mb-3 border-bottom pb-2">Cloudinary Editor</h5>
                                    <div class="d-flex flex-wrap">
                                        <div class="filter-chip" onclick="applyEffect('biochem_art')">üé® Sci-Art</div>
                                        <div class="filter-chip" onclick="applyEffect('sketch')">‚úèÔ∏è Sketch</div>
                                        <div class="filter-chip" onclick="applyEffect('glam')">‚ú® Glamour</div>
                                        <div class="filter-chip" onclick="applyEffect('love')">‚ù§Ô∏è Love</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-7">
                                <div class="image-stage shadow-sm" id="imgStage">
                                    <div class="spinner-container">
                                        <i class="fa-regular fa-image fa-3x mb-3 opacity-50"></i>
                                        <span>AI Art Canvas</span>
                                    </div>
                                </div>
                                <div class="text-end mt-2">
                                    <small class="text-muted fst-italic">Powered by Me</small>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    let currentPublicId = null;

    function fillSmiles(s) {
        document.getElementById('smilesInput').value = s;
    }

    // --- BIOCHEM LOGIC ---
    async function analyzeMolecule() {
        const smiles = document.getElementById('smilesInput').value;
        const resultDiv = document.getElementById('chemResult');
        const emptyDiv = document.getElementById('chemEmpty');
        
        // UI Loading State
        emptyDiv.classList.add('d-none');
        resultDiv.classList.add('d-none');
        
        try {
            const res = await fetch('/analyze_chem', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({smiles: smiles})
            });
            const data = await res.json();
            
            if(data.error) {
                alert(data.error); 
                emptyDiv.classList.remove('d-none');
                return;
            }

            // Show Results
            resultDiv.classList.remove('d-none');
            document.getElementById('molImage').src = data.image_url;
            document.getElementById('molClass').innerText = data.classification;
            document.getElementById('molConf').style.width = data.confidence + '%';
            document.getElementById('confText').innerText = data.confidence + '%';
            
        } catch (e) {
            console.error(e);
            alert("Error connecting to server.");
            emptyDiv.classList.remove('d-none');
        }
    }

    // --- CREATIVE LOGIC ---
    async function generateImage() {
        const prompt = document.getElementById('imgPrompt').value;
        const btn = document.getElementById('genBtn');
        const stage = document.getElementById('imgStage');
        
        if(!prompt) return alert("Please write a prompt first!");

        // Loading UI
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Dreaming...';
        stage.innerHTML = `
            <div class="spinner-container">
                <div class="spinner-grow text-secondary mb-3" style="width: 3rem; height: 3rem;"></div>
                <p>Generating unique art for you...</p>
            </div>`;

        try {
            const res = await fetch('/generate_image', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({prompt: prompt})
            });
            const data = await res.json();

            if(data.success) {
                currentPublicId = data.public_id;
                stage.innerHTML = `<img src="${data.cloudinary_url}" id="artCanvas" class="animate__animated animate__fadeIn">`;
                document.getElementById('editorTools').classList.remove('d-none');
            } else {
                stage.innerHTML = `<div class="text-danger text-center p-4"><i class="fa-solid fa-triangle-exclamation mb-2"></i><br>${data.error || 'Generation failed.'}</div>`;
            }
        } catch(e) {
            console.error(e);
            stage.innerHTML = '<div class="text-danger p-4">Server connection failed.</div>';
        }
        
        // Reset Button
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles me-2"></i>Generate Art';
    }

    async function applyEffect(effect) {
        if(!currentPublicId) return;
        
        const stage = document.getElementById('imgStage');
        const img = document.getElementById('artCanvas');
        
        // Visual Feedback
        if(img) img.style.opacity = '0.5';

        try {
            const res = await fetch('/transform_image', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({public_id: currentPublicId, effect: effect})
            });
            const data = await res.json();
            
            stage.innerHTML = `<img src="${data.new_url}" id="artCanvas" class="animate__animated animate__pulse">`;
        } catch(e) {
            console.error(e);
            alert("Failed to apply filter");
            if(img) img.style.opacity = '1';
        }
    }
</script>

</body>
</html>